doctype html

html
	head
		meta(charset="utf-8")
		meta(name="viewport" content="width=device-width, initial-scale=1.0")
		meta(property="og:title" content="XXX的測驗結果")
		meta(property="og:image" content="https://rogeryeeaah.github.io/hm/img/1.jpg")
		title NesswellnessWheel - Know about your self

		script(src="scripts/v3.2.8/vue.global.prod.js" type="text/javascript" charset="utf-8")
		script(src="./scripts/jquery/jquery.min.js")
		script(src="./scripts/jquery/jquery-ui.js")
		script(src="./scripts/axios/axios.min.js")
		script(src="./scripts/data.js")
		
		link(rel="stylesheet", href="./styles/jquery/jquery-ui.css")
		link(rel="stylesheet", href="./styles/reset.css")
		link(rel="stylesheet", href="./styles/custom.css")

	body
		#app.form(action="question_page.html")
			.container
				.title-box.t-C
					.title Tell us a little about yourself first...
				form
					.col-1.m-B-30.flex
						input#name(type="text" v-model="name" :placeholder="info.name" required)
					.col-1.m-B-30.flex
						input(type="email" v-model="email" required="required" :placeholder="info.email" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$")
					.col-1.m-B-30.flex
						.title {{ info.birthday }}
						input#datepicker(type="text" v-model="date" name="date" placeholder="YYYY / MM / DD")
					.col-1.m-B-30.flex
						.title {{ info.gender }}
						.radio
							input(:id="info.genderOpt[0]" type="radio" name="gender" v-model="gender" value="Male" required)
							label(:for="info.genderOpt[0]") {{ info.genderOpt[0] }}
							input(:id="info.genderOpt[1]" type="radio" name="gender" v-model="gender" value="Female" required)
							label(:for="info.genderOpt[1]") {{ info.genderOpt[1] }}
							label(:for="info.genderOpt[2]") {{ info.genderOpt[2] }}
							input(:id="info.genderOpt[2]" type="radio" name="gender" v-model="gender" value="Other" required)
					a.m-H-40
						input(type="submit" value="Submit" @click="dataPost")

		include ./include/footer
		
		script.
			const app = Vue.createApp({
				data() {
					return {
						info: [],
						name: '',
						email: '',
						date: '',
						gender: '',
						len: localStorage.len,
						personInfo: []
					}
				},
				created: function() {
					this.onContentCatch();
				},
				mounted: function() {
					//- dtpk
					var self = this
					$("#datepicker").datepicker({
						dateFormat: 'yy / mm / dd',
						changeYear: true,
						changeMonth: true,
						onSelect: function(date) {
							self.date = date
						}
					});

					//- 資料驗證
					$('form').submit(function(e) {
						e.preventDefault();
						if(!$('input[name="gender"]:checked').val()) {
							$('input[name="gender"]')[0].setCustomValidity("Please select one of the genders.");
							this.reportValidity();
							return;
						}
						window.location.href = './question_page.html';
						localStorage.name = self.name
					});
				},
				methods: {
					onContentCatch: function() {
						if(this.len === 'en') {
							this.info = pageData.en.info;
						} else if(this.len === '中') {
							this.info = pageData.ch.info;
						} else {
							this.info = pageData.en.info;
						}
					},
					dataPost: function() {
						console.log(this.email, this.name, this.date, this.gender)
						axios({
							method: 'post',
							url: pageData.DBurl,
							headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*'},
							data: {
								"email": this.email,
								"name": this.name,
								"birthday": this.date,
								"gender": this.gender
							}
						})
						.then( (response) => console.log(window.location.href))
						.catch( (error) => console.log(error));
					}
				}
			});

			app.mount('#app');