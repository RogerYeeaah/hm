<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="XXX的測驗結果">
    <meta property="og:image" content="https://rogeryeeaah.github.io/hm/img/1.jpg">
    <title>NesswellnessWheel - Know about your self</title>
    <script src="scripts/v3.2.8/vue.global.prod.js" type="text/javascript" charset="utf-8"></script>
    <script src="./scripts/jquery/jquery.min.js"></script>
    <script src="./scripts/swiper/swiper-bundle.min.js"></script>
    <script src="./scripts/data.js"></script>
    <link rel="stylesheet" href="./styles/reset.css">
    <link rel="stylesheet" href="./styles/swiper/swiper.min.css">
    <link rel="stylesheet" href="./styles/custom.css">
  </head>
  <body class="cate-01">
    <div class="question-page" id="app">
      <div class="container">
        <div class="function-box">
          <div class="swiper-pagination"></div><span class="des">Completed</span>
        </div>
        <div class="swiper mySwiper">
          <div class="swiper-wrapper">
            <qs :qs="this"></qs>
          </div>
          <div class="process-box"><span class="current">{{ curQ }}</span><span>/ </span><span class="total">{{ totalCount }}</span><span> questions answered</span></div>
          <div class="swiper-next">Next</div>
          <div class="swiper-prev">Back</div>
        </div>
        <div class="submit-box" :class="">
          <button id="submit" :class="curQ === totalCount ? '':'disabled'" type="submit" value="Submit" @click="cul(result)">Submit</button>
        </div>
      </div>
    </div>
    <div class="footer">
      <div class="container">
        <div class="logo-box"><span>Powered by</span>
          <div class="logo" style="background-image: url(./img/logo.png)"></div>
        </div>
      </div>
    </div>
    <script id="qs" type="text/x-template">
      <div class="swiper-slide" :class="index === qs.questions.length - 1 ? 'last-one':''" v-for="(items, index) in qs.questions" :key="index">
        <div class="scroll-box">
          <qc :qc="qs.questions[index]" :qcs="qs"></qc>
        </div>
      </div>
    </script>
    <script id="qc" type="text/x-template">
      <div class="q-card" v-for="(items, index) in qc" :key="index">
        <div class="question">{{ items.title }}</div>
        <div class="option-box">
          <p v-show="qcs.len === 'en'">Rarely</p>
          <p v-show="qcs.len === '中'">很常</p>
          <sp :sp="items" :qc="qc" :qcc="qcs" @childEvent="parentEvent"></sp>
          <p class="right" v-show="qcs.len === 'en'">Always</p>
          <p class="right" v-show="qcs.len === '中'">不常</p>
        </div>
      </div>
    </script>
    <script id="sp" type="text/x-template">
      <div class="box" :class="activeClass == index ? 'option active':'option'" v-for="index in 7" @click="onAnswerClick(index)">
        <label :for="sp.categoryId + '-' + sp.questionId + '-' + index"></label>
        <input :id="sp.categoryId + '-' + sp.questionId + '-' + index" :key="index" type="radio" :data-cate="sp.categoryId" :data-percentage="sp.percentage" :data-option="index" :name="sp.categoryId+ '-' + sp.questionId">
      </div>
    </script>
    <script>
      const app = Vue.createApp({
      	data() {
      		return {
      			questions: [],
      			result: [],
      			curQ: 0,
      			totalQ: 0,
      			len: localStorage.len
      		}
      	},
      	created: function() {
      		this.onContentCatch();
      	},
      	mounted: function() {
      		var swiper = new Swiper(".mySwiper", {
      			slidePerView: '1',
      			pagination: {
      				el: ".swiper-pagination",
      				type: "progressbar",
      			},
      			navigation: {
      				nextEl: ".swiper-next",
      				prevEl: ".swiper-prev",
      			},
      		});
      
      		swiper.on('slideChangeTransitionEnd', function(){
      			var num = swiper.activeIndex+1;
      			$('body').attr('class', 'cate-0' + num);
      			if($('.swiper-slide-active').hasClass('last-one')) {
      				$('.submit-box').addClass('show');
      			} else {
      				$('.submit-box').removeClass('show');
      			}
      		});
      	},
      	methods: {
      		onContentCatch: function() {
      			if(this.len === 'en') {
      				this.questions = pageData.en.questions;
      			} else if(this.len === '中') {
      				this.questions = pageData.ch.questions;
      			} else {
      				this.questions = pageData.en.questions;
      			}
      		},
      		cul: function(e) {
      			var active = window.document.querySelectorAll('.active'),
      				actives = window.document.querySelectorAll('.active').length,
      				emo = 0,
      				phy = 0,
      				spi = 0,
      				int = 0,
      				soc = 0,
      				env = 0,
      				occ = 0,
      				fin = 0,
      				index;
      			
      			for (i = 0; i < actives; i++) {
      				var input = active[i].querySelector('input'),
      					tPer = input.dataset.percentage,
      					tOption = input.dataset.option * 10 / 7,
      					tScore = mulFloat(tPer, tOption);
      
      				console.log(tPer, tOption, tScore);
      				if(input.dataset.cate === '1') {
      					emo += tScore;
      				} else if (input.dataset.cate === '2') {
      					phy += tScore;
      				} else if (input.dataset.cate === '3') {
      					spi += tScore;
      				} else if (input.dataset.cate === '4') {
      					int += tScore;
      				} else if (input.dataset.cate === '5') {
      					soc += tScore;
      				} else if (input.dataset.cate === '6') {
      					env += tScore;
      				} else if (input.dataset.cate === '7') {
      					occ += tScore;
      				} else if (input.dataset.cate === '8') {
      					fin += tScore;
      				}
      			}
      			localStorage.emo = emo = emo.toFixed(2);
      			localStorage.phy = phy = phy.toFixed(2);
      			localStorage.spi = spi = spi.toFixed(2);
      			localStorage.int = int = int.toFixed(2);
      			localStorage.soc = soc = soc.toFixed(2);
      			localStorage.env = env = env.toFixed(2);
      			localStorage.occ = occ = occ.toFixed(2);
      			localStorage.fin = fin = fin.toFixed(2);
      			console.log(emo, phy, spi, int, soc, env, occ, fin);
      		}
      	},
      	computed: {
      		totalCount: function() {
      			var r = 0;
      			this.questions.forEach(function(d){
      				r += d.length; 
      			})
      			return r;
      		}
      	}
      });
      
      app.component('qs', {
      	template: '#qs',
      	props:['qs']
      });
      
      app.component('qc', {
      	template: '#qc',
      	props:['qc', 'qcs']
      });
      
      app.component('sp', {
      	template: '#sp',
      	data: function () {
      		return {
      			activeClass: -1
      		}
      	},
      	props:['sp', 'qc', 'qcc'],
      	methods: {
      		onAnswerClick: function(index){
      			this.activeClass = index;
      			this.qcc.curQ = window.document.querySelectorAll('.active').length;
      		},
      		add: function(){
      			this.$emit("childEvent", this.age);
      		}
      	}
      });
      
      app.mount('#app');
    </script>
  </body>
</html>